<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
</head>

<body>
    <button id="join-room">Join Room</button>
    <div id="videos-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/rtcmulticonnection@3.6.9/dist/RTCMultiConnection.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/7.3.0/adapter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

    <script>
        const ROOMID = 'lexa-private-room-mwahahah';
        var connection = new RTCMultiConnection();

        connection.socketURL = 'https://rtcmulticonnection.herokuapp.com:443/';
        connection.socketMessageEvent = 'video-broadcast-demo';
        connection.session = {
            audio: true,
            video: true,
            oneway: true
        };
        connection.sdpConstraints.mandatory = {
            OfferToReceiveAudio: false,
            OfferToReceiveVideo: false
        };
        connection.iceServers = [{
            'urls': [
                'stun:stun.l.google.com:19302',
                'stun:stun1.l.google.com:19302',
                'stun:stun2.l.google.com:19302',
                'stun:stun.l.google.com:19302?transport=udp',
            ]
        }];

        connection.videosContainer = document.getElementById('videos-container');
        connection.onstream = (event) => {
            console.log('onstream', event);
            var existing = document.getElementById(event.streamid);
            if (existing && existing.parentNode) {
                existing.parentNode.removeChild(existing);
            }

            event.mediaElement.controls = false;
            connection.videosContainer.appendChild(event.mediaElement);
        };

        connection.onstreamended = (event) => console.log('onstream end', event);
        connection.onMediaError = (e) => console.log('media error', e);

        // document.getElementById('open-room').onclick = () => {
        //     connection.open(ROOMID, () => console.log('connected', ROOMID));
        // };

        if (document.location.hash !== "#server") {
            document.getElementById('join-room').onclick = () => {
                connection.sdpConstraints.mandatory = {
                    OfferToReceiveAudio: true,
                    OfferToReceiveVideo: true
                };
                connection.join(ROOMID);
            };
        } else {
            document.getElementById('join-room').remove();
            connection.open(ROOMID, () => console.log('connected', ROOMID));
        }
    </script>
</body>

</html>